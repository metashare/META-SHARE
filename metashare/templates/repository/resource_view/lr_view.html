{% extends "base.html" %}
{% load get_icon %}

{% block title %}
  {{ resourceName }} &ndash; META-SHARE
{% endblock %}

{% block links %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/resource_view.css" />
{% endblock %}

{% block description %}{{ description|truncatewords:30 }}{% endblock %}

{% block keywords %}{{ resourceType }}, {{ mediaTypes|join:", " }}, {{ linguality_infos|join:", " }}, {{ resource.distributionInfo.get_availability_display }}, {{ license_types|join:", " }}{% endblock %}

{% block content %}
{% spaceless %}
	<script type="text/javascript" src="http://plugins.learningjquery.com/expander/jquery.expander.js"></script>
	<script type="text/javascript">
		$(function () {
			$('.readmore').expander({
				slicePoint: 300,
				expandText: 'Read More',
				userCollapseText: 'Read Less',
				expandEffect: 'show',
				expandSpeed: 0,
				collapseEffect: 'hide',
				collapseSpeed: 0
			});
		});

		$(document).ready(function(){  
			$(".tab_content").hide();
			$(".fields li:first-child").addClass("active");
			var selected_tab = $(".fields li.active").find("a").attr("href");
			$(selected_tab).fadeIn();
			$(".fields li").click(function() {
				$(".fields li").removeClass("active");
				$(this).addClass("active");
				$(".tab_content").hide();
				var selected_tab = $(this).find("a").attr("href");
				$(selected_tab).fadeIn();
				return false;
	  		});
	  		
	  		
			$(".dataline.optional").hide();
				$(".expandable").addClass("collapsed");
				$(".expandable").click(function() {
				if($(this).hasClass("collapsed")){
				$(this).removeClass('collapsed');
				$(this).addClass('expanded');
				$(this).nextUntil(".title.component").show();
				}
				else{
					$(this).removeClass('expanded');
					$(this).addClass('collapsed');	
					$(this).nextAll().each( function() {
					if ($(this).filter('.title').length) {
					return false;
					}
					$(this).filter('.optional').hide();
					});
				
				}
				});
				
				$(".more").addClass("collapsed");
				$(".otherlang").hide();
				$(".more").click(function() {
					if($(this).hasClass("collapsed")){
					$(this).removeClass('collapsed');
					$(this).addClass('expanded');
				}
				else{
					$(this).removeClass('expanded');
					$(this).addClass('collapsed');	
				}
				
				
				$(this).next().toggle();
			
			});
			
			$(".contactcard").click(function() {				
				$(this).next().toggle();
				return false;				
			});
		});
	</script>

	<div class="top_box white_box">
		<div id="stats" align="right">
            {% for stat in LR_STATS %}
                {%if "updated" in stat.action %}
                    &nbsp;<div align=right style="float: right"><i>(Last modified: {{ stat.last }})</i>&nbsp;</div>
                {% else %}
                	<a href="#" class="tip">
                    <img src="{{ MEDIA_URL }}stats/img/{{ stat.action }}_icon.gif"
                    alt="Last {{ stat.action }}: {{ stat.last }}"/>
                    <b>{{ stat.count }}</b>&nbsp;
                    <span>Last {{ stat.action }}: {{ stat.last }}</span>
                    </a>
                    
                {% endif %}
            {% endfor %}
        </div>
		<h2>{{ resourceName }} {% get_icon resourceType %}</h2>
		
		{% ifnotequal other_res_names|length 0 %}
			<div class='more'>View resource name in all available languages</div>
			<div class='otherlang'>
			{% for name in other_res_names %}<h3>{{ name }}</h3>{% endfor %} 
			</div>
		{% endifnotequal %}
		
		<h3 class="shortnames">{% for name in res_short_names %}{{ name }}<img src="{{ MEDIA_URL }}images/trenner.png" class="trenner" />{% endfor %}</h3> 
		{% if url.0 %}
		<h4 class='url'><a href="{{url.0}}" target="_blank">{{url.0}}</a></h4>
		{% endif %}
		
		{% if not 'NOT_DEFINED' in metaShareId %}<h4 class="identifier">{{ metaShareId }}</h4>{% endif %}
		<h4 style="text-align:justify" class="readmore desc">{{ description }}</h4>
		
		{% ifnotequal other_descriptions|length 0 %}
			<div class='more'>View resource description in all available languages</div>
			<div class='otherlang'>
			{% for desc in other_descriptions %}<h4 style="text-align:justify" class="readmore">{{ desc }}</h4>{% endfor %} 
			</div> 
		{% endifnotequal %}
		
		<div style="clear: both;">
			<a href="javascript:history.back();"><button class="span-12 button middle_button">&laquo; Back</button></a>
		    <a {% if LR_DOWNLOAD %} href="{% url metashare.repository.views.download resource.storage_object.identifier %}" {% else %} href="#" class="tip" {% endif %}>
		  		<span class="download">You don&rsquo;t have the permission to download this resource. Please log in.</span>
		       	<button class="span-4 button {% if LR_DOWNLOAD %}middle_button{% else %}middle_gray_button{% endif %}">Download</button>
		    </a>
		  	<a {% if LR_EDIT %} href="{{ LR_EDIT }}" {% else %} href="#" class="tip" {% endif %}>
				<span class="edit">You don&rsquo;t have the permission to edit this resource.</span>
		       	<button class="span-4 button {% if LR_EDIT %}middle_button{% else %}middle_gray_button{% endif %}">Edit Resource</button>
		    </a>
			<div style="clear: both;"></div>
		</div>
	</div>
	
	<div class="white_box column corner">
		{% include "repository/resource_view/detailed_component.html" with lr_content=distribution_info_tuple %}
		
		{% for contact_person in contact_person_dicts %}
			 {% include "repository/resource_view/person_info.html" with contact_person_dict=contact_person %}
		{% endfor %}

		{% for person in object.contactPerson_set.all %}
			{{ person }}
		{% endfor %}
		{{ resource_component_dict.Resource_component.Resource }}
	</div>
		
	<div class="column middle">
		<div class="fields">
				<ul>
					{% ifequal resourceType "toolService" %}
						<li><a href="#1">toolService{% get_icon "toolService" %}</a></li>
					{% else %}
						{% for type in mediaTypes %}
							<li><a href="#{{forloop.counter}}">{{type}}{% get_icon type %}</a></li>
						{% endfor %}
					{% endifequal %}						
					
				</ul>
			</div>
		<div class="white_box middle_box">
		{% ifequal resourceType "toolService" %}
			<div id="tabs_content_container">
				<div id="1" class="tab_content">
					{% include "repository/resource_view/media_info.html" with type='toolService' %}
				</div>
			</div>
		{% else %}
			{% for type in mediaTypes %}
				<div id="tabs_content_container">
					<div id="{{forloop.counter}}" class="tab_content">
						{% include "repository/resource_view/media_info.html" with type=type %}
					</div>
				</div>
			{% endfor %}
		{% endifequal %}
		</div>
	</div>

	<div class="white_box column corner right-corner">
	
		{% if resource_creation_info_tuple %}
			{% include "repository/resource_view/resource_creation.html" %}
		{% endif %}
		  
		{% include "repository/resource_view/metadata.html" %}
		
		{% if validation_info_tuples %}
			{% include "repository/resource_view/validation.html" %}
		{% endif %}
		
		{% if usage_info_tuple %}
			{% include "repository/resource_view/usage.html" %}
		{% endif %}
		
		{% if relation_info_tuples %}
			{% include "repository/resource_view/relation.html" %}
		{% endif %}
		
		{% if documentation_dict %}
			{% for key, value in documentation_dict.items %}
				{% for key1, value1 in value.items %}		
					{% for key2, value2 in value1.items %}				
						{% if key2 == "Documentation" %}
							{% include "repository/resource_view/documentation.html" with documentation=value2 type="Documentation" %}
						{% endif %}
					{% endfor %}
				{% endfor %}
			{% endfor %}
		{% endif %}
	
	</div>

{% include "repository/resource_view/recomm_view.html" %}
{% endspaceless %}
{% endblock %}
